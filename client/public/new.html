<!DOCTYPE html>

<html>

<head>
    <title>view</title>
    <script script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script>
        var post;
        var latitude, longtitude;
        $(document).ready(function () {
            console.log("click " + latitude + longtitude);
            $.post('/showpost', { lat: latitude, lng: longtitude }, function (data, status) {
                post = data;
                console.log(data);
            })
        })

        function show() {
            console.log("click");
            var show_comment = document.querySelector('#show_comment');

            //comment수 반복문으로 받아오기
            var div1 = document.createElement('div');
            var div2 = document.createElement('div');
            var div_user = document.createElement('div');
            var div_time = document.createElement('div');
            var div_comment = document.createElement('div');

            div_user.setAttribute("id", 'dv_name');
            div_user.innerHTML = post.user;
            div_time.setAttribute("id", 'time');
            div_time.innerHTML = post.time;
            div_comment.setAttribute("id", 'comment');
            div_comment.innerHTML = post.comment;
            div1.appendChild(div_user);
            div1.appendChild(div_time);
            div2.appendChild(div_comment);

            show_comment.appendChild(div1);
            show_comment.appendChild(div2);

            //댓글창 보이기
            var add_comment = document.querySelector('#add_comment');
            var add_text = document.createElement('textarea');
            var done = document.createElement('button');
            add_text.setAttribute("id", "add");
            add_text.setAttribute("col", "50");
            add_text.setAttribute("row", "30");
            add_text.setAttribute("placeholder", "댓글을 남겨주세요")
            done.setAttribute("type", "button");
            done.setAttribute("id", "done");
            done.innerHTML = comment;

            add_comment.appendChild(add_text);
            add_comment.appendChild(done);
        }

        $('#done').click(function () {

            var comment = $('#add').text();
            var time = new Date().toLocaleDateString();

            var div_user = document.createElement('div');
            var div_time = document.createElement('div');
            var div_comment = document.createElement('div');

            div_user.setAttribute("id", 'dv_name');
            div_user.innerHTML = post.user;
            div_time.setAttribute("id", 'time');
            div_time.innerHTML = time;
            div_comment.setAttribute("id", 'comment');
            div_comment.innerHTML = comment;
            div1.appendChild(div_user);
            div1.appendChild(div_time);
            div2.appendChild(div_comment);

            show_comment.appendChild(div1);
            show_comment.appendChild(div2);

            //몽고디비에 추가하기
            console.log("comment" + comment);
            $.post(url + '/showpost', { post_id: post._id, post_name: post.user, post_time: time, post_comment: comment },
                function (data, status) {
                    console.log("전송완료");
                })
        })

    </script>
</head>

<body>
    <article>
        <header id="header" style="border: 5px solid black;">
            <div id="제목">name</div>
            <div id="작성자">user</div>
        </header>

        <div id="posting_photo" style="border: 5px solid black;">
            <section id="imgs">
                file[]배열 출력
            </section>
        </div>

        <div id="posting_add" style="border: 5px solid black;">
            <div>
                <button type="button"> 좋아요 </button>
                <button type="button" onclick="show()"> 댓글보기 및 달기 </button>
            </div>
        </div>

        <div id="information" style="border: 5px solid black;">
            <div id="작성날자">time</div>
            <div id="카테고리">category</div>
        </div>

        <div id="posting_comment" style="border: 5px solid black;">
            <div>본문 comment</div>
        </div>

        <div id="show_comment" style="border: 5px solid black;"></div>
        <div id="add_comment" style="border: 5px solid black;"></div>
    </article>
</body>

</html>